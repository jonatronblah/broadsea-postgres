/*********************************************************************************
# COPYRIGHT 2017-11 OBSERVATIONAL HEALTH DATA SCIENCES AND INFORMATICS
#
#
# LICENSED UNDER THE APACHE LICENSE, VERSION 2.0 (THE "LICENSE")
# YOU MAY NOT USE THIS FILE EXCEPT IN COMPLIANCE WITH THE LICENSE.
# YOU MAY OBTAIN A COPY OF THE LICENSE AT
#
#     HTTP://WWW.APACHE.ORG/LICENSES/LICENSE-2.0
#
# UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING, SOFTWARE
# DISTRIBUTED UNDER THE LICENSE IS DISTRIBUTED ON AN "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED.
# SEE THE LICENSE FOR THE SPECIFIC LANGUAGE GOVERNING PERMISSIONS AND
# LIMITATIONS UNDER THE LICENSE.
********************************************************************************/

/************************

 ####### #     # ####### ######      #####  ######  #     #           #######      #####
 #     # ##   ## #     # #     #    #     # #     # ##   ##    #    # #           #     #
 #     # # # # # #     # #     #    #       #     # # # # #    #    # #                 #
 #     # #  #  # #     # ######     #       #     # #  #  #    #    # ######       #####
 #     # #     # #     # #          #       #     # #     #    #    #       # ###       #
 #     # #     # #     # #          #     # #     # #     #     #  #  #     # ### #     #
 ####### #     # ####### #           #####  ######  #     #      ##    #####  ###  #####


POSTGRESQL SCRIPT TO CREATE OMOP COMMON DATA MODEL VERSION 5.3

LAST REVISED: 14-JUNE-2018

AUTHORS:  PATRICK RYAN, CHRISTIAN REICH, CLAIR BLACKETER


*************************/


/************************

STANDARDIZED VOCABULARY

************************/


CREATE TABLE cdm.CONCEPT (
  CONCEPT_ID			    INTEGER			  NOT NULL ,
  CONCEPT_NAME			  VARCHAR(255)	NOT NULL ,
  DOMAIN_ID				    VARCHAR(20)		NOT NULL ,
  VOCABULARY_ID			  VARCHAR(20)		NOT NULL ,
  CONCEPT_CLASS_ID		VARCHAR(20)		NOT NULL ,
  STANDARD_CONCEPT		VARCHAR(1)		NULL ,
  CONCEPT_CODE			  VARCHAR(50)		NOT NULL ,
  VALID_START_DATE		DATE			    NOT NULL ,
  VALID_END_DATE		  DATE			    NOT NULL ,
  INVALID_REASON		  VARCHAR(1)		NULL
)
;


CREATE TABLE cdm.VOCABULARY (
  VOCABULARY_ID			    VARCHAR(20)		NOT NULL,
  VOCABULARY_NAME		    VARCHAR(255)	NOT NULL,
  VOCABULARY_REFERENCE	VARCHAR(255)	NOT NULL,
  VOCABULARY_VERSION VARCHAR(255) NULL,
  VOCABULARY_CONCEPT_ID	INTEGER			  NOT NULL
)
;


CREATE TABLE cdm.DOMAIN (
  DOMAIN_ID			    VARCHAR(20)		NOT NULL,
  DOMAIN_NAME		    VARCHAR(255)	NOT NULL,
  DOMAIN_CONCEPT_ID	INTEGER			  NOT NULL
)
;


CREATE TABLE cdm.CONCEPT_CLASS (
  CONCEPT_CLASS_ID			    VARCHAR(20)		NOT NULL,
  CONCEPT_CLASS_NAME		    VARCHAR(255)	NOT NULL,
  CONCEPT_CLASS_CONCEPT_ID	INTEGER			  NOT NULL
)
;


CREATE TABLE cdm.CONCEPT_RELATIONSHIP (
  CONCEPT_ID_1			INTEGER			NOT NULL,
  CONCEPT_ID_2			INTEGER			NOT NULL,
  RELATIONSHIP_ID		VARCHAR(20)	NOT NULL,
  VALID_START_DATE	DATE			  NOT NULL,
  VALID_END_DATE		DATE			  NOT NULL,
  INVALID_REASON		VARCHAR(1)	NULL
  )
;


CREATE TABLE cdm.RELATIONSHIP (
  RELATIONSHIP_ID			    VARCHAR(20)		NOT NULL,
  RELATIONSHIP_NAME			  VARCHAR(255)	NOT NULL,
  IS_HIERARCHICAL			    VARCHAR(1)		NOT NULL,
  DEFINES_ANCESTRY			  VARCHAR(1)		NOT NULL,
  REVERSE_RELATIONSHIP_ID	VARCHAR(20)		NOT NULL,
  RELATIONSHIP_CONCEPT_ID	INTEGER			  NOT NULL
)
;


CREATE TABLE cdm.CONCEPT_SYNONYM (
  CONCEPT_ID			      INTEGER			  NOT NULL,
  CONCEPT_SYNONYM_NAME	VARCHAR(1000)	NOT NULL,
  LANGUAGE_CONCEPT_ID	  INTEGER			  NOT NULL
)
;


CREATE TABLE cdm.CONCEPT_ANCESTOR (
  ANCESTOR_CONCEPT_ID		    INTEGER		NOT NULL,
  DESCENDANT_CONCEPT_ID		  INTEGER		NOT NULL,
  MIN_LEVELS_OF_SEPARATION	INTEGER		NOT NULL,
  MAX_LEVELS_OF_SEPARATION	INTEGER		NOT NULL
)
;


CREATE TABLE cdm.SOURCE_TO_CONCEPT_MAP (
  SOURCE_CODE				      VARCHAR(50)		NOT NULL,
  SOURCE_CONCEPT_ID			  INTEGER			  NOT NULL,
  SOURCE_VOCABULARY_ID		VARCHAR(20)		NOT NULL,
  SOURCE_CODE_DESCRIPTION	VARCHAR(255)	NULL,
  TARGET_CONCEPT_ID			  INTEGER			  NOT NULL,
  TARGET_VOCABULARY_ID		VARCHAR(20)		NOT NULL,
  VALID_START_DATE			  DATE			    NOT NULL,
  VALID_END_DATE			    DATE			    NOT NULL,
  INVALID_REASON			    VARCHAR(1)		NULL
)
;




CREATE TABLE cdm.DRUG_STRENGTH (
  DRUG_CONCEPT_ID				      INTEGER		  NOT NULL,
  INGREDIENT_CONCEPT_ID			  INTEGER		  NOT NULL,
  AMOUNT_VALUE					      NUMERIC		    NULL,
  AMOUNT_UNIT_CONCEPT_ID		  INTEGER		  NULL,
  NUMERATOR_VALUE				      NUMERIC		    NULL,
  NUMERATOR_UNIT_CONCEPT_ID		INTEGER		  NULL,
  DENOMINATOR_VALUE				    NUMERIC		    NULL,
  DENOMINATOR_UNIT_CONCEPT_ID	INTEGER		  NULL,
  BOX_SIZE						        INTEGER		  NULL,
  VALID_START_DATE				    DATE		    NOT NULL,
  VALID_END_DATE				      DATE		    NOT NULL,
  INVALID_REASON				      VARCHAR(1)  NULL
)
;



CREATE TABLE cdm.COHORT_DEFINITION (
  COHORT_DEFINITION_ID				    INTEGER			  NOT NULL,
  COHORT_DEFINITION_NAME			    VARCHAR(255)	NOT NULL,
  COHORT_DEFINITION_DESCRIPTION		TEXT	NULL,
  DEFINITION_TYPE_CONCEPT_ID		  INTEGER			  NOT NULL,
  COHORT_DEFINITION_SYNTAX			  TEXT	NULL,
  SUBJECT_CONCEPT_ID				      INTEGER			  NOT NULL,
  COHORT_INITIATION_DATE			    DATE			    NULL
)
;


CREATE TABLE cdm.ATTRIBUTE_DEFINITION (
  ATTRIBUTE_DEFINITION_ID		  INTEGER			  NOT NULL,
  ATTRIBUTE_NAME				      VARCHAR(255)	NOT NULL,
  ATTRIBUTE_DESCRIPTION			  TEXT	NULL,
  ATTRIBUTE_TYPE_CONCEPT_ID		INTEGER			  NOT NULL,
  ATTRIBUTE_SYNTAX				    TEXT	NULL
)
;


/**************************

STANDARDIZED META-DATA

***************************/


CREATE TABLE cdm.CDM_SOURCE
(
  CDM_SOURCE_NAME					        VARCHAR(255)	NOT NULL ,
  CDM_SOURCE_ABBREVIATION			    VARCHAR(25)		NULL ,
  CDM_HOLDER							        VARCHAR(255)	NULL ,
  SOURCE_DESCRIPTION					    TEXT	NULL ,
  SOURCE_DOCUMENTATION_REFERENCE	VARCHAR(255)	NULL ,
  CDM_ETL_REFERENCE					      VARCHAR(255)	NULL ,
  SOURCE_RELEASE_DATE				      DATE			    NULL ,
  CDM_RELEASE_DATE					      DATE			    NULL ,
  CDM_VERSION						          VARCHAR(10)		NULL ,
  VOCABULARY_VERSION					    VARCHAR(20)		NULL
)
;


CREATE TABLE cdm.METADATA
(
  METADATA_CONCEPT_ID       INTEGER       NOT NULL ,
  METADATA_TYPE_CONCEPT_ID  INTEGER       NOT NULL ,
  NAME                      VARCHAR(250)  NOT NULL ,
  VALUE_AS_STRING           TEXT  NULL ,
  VALUE_AS_CONCEPT_ID       INTEGER       NULL ,
  METADATA_DATE             DATE          NULL ,
  METADATA_DATETIME         TIMESTAMP      NULL
)
;


/************************

STANDARDIZED CLINICAL DATA

************************/

--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.PERSON
(
  PERSON_ID						        INTEGER	  	NOT NULL ,
  GENDER_CONCEPT_ID				    INTEGER	  	NOT NULL ,
  YEAR_OF_BIRTH					      INTEGER	  	NOT NULL ,
  MONTH_OF_BIRTH				      INTEGER	  	NULL,
  DAY_OF_BIRTH					      INTEGER	  	NULL,
  BIRTH_DATETIME				      TIMESTAMP	  NULL,
  RACE_CONCEPT_ID				      INTEGER		  NOT NULL,
  ETHNICITY_CONCEPT_ID			  INTEGER	  	NOT NULL,
  LOCATION_ID					        INTEGER		  NULL,
  PROVIDER_ID					        INTEGER		  NULL,
  CARE_SITE_ID					      INTEGER		  NULL,
  PERSON_SOURCE_VALUE			    VARCHAR(50) NULL,
  GENDER_SOURCE_VALUE			    VARCHAR(50) NULL,
  GENDER_SOURCE_CONCEPT_ID	  INTEGER		  NULL,
  RACE_SOURCE_VALUE				    VARCHAR(50) NULL,
  RACE_SOURCE_CONCEPT_ID		  INTEGER		  NULL,
  ETHNICITY_SOURCE_VALUE		  VARCHAR(50) NULL,
  ETHNICITY_SOURCE_CONCEPT_ID	INTEGER		  NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.OBSERVATION_PERIOD
(
  OBSERVATION_PERIOD_ID				      INTEGER		NOT NULL ,
  PERSON_ID							            INTEGER		NOT NULL ,
  OBSERVATION_PERIOD_START_DATE		  DATE		  NOT NULL ,
  OBSERVATION_PERIOD_END_DATE		    DATE		  NOT NULL ,
  PERIOD_TYPE_CONCEPT_ID			      INTEGER		NOT NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.SPECIMEN
(
  SPECIMEN_ID						      INTEGER			NOT NULL ,
  PERSON_ID							      INTEGER			NOT NULL ,
  SPECIMEN_CONCEPT_ID				  INTEGER			NOT NULL ,
  SPECIMEN_TYPE_CONCEPT_ID		INTEGER			NOT NULL ,
  SPECIMEN_DATE						    DATE			  NOT NULL ,
  SPECIMEN_DATETIME					  TIMESTAMP		NULL ,
  QUANTITY							      NUMERIC			  NULL ,
  UNIT_CONCEPT_ID					    INTEGER			NULL ,
  ANATOMIC_SITE_CONCEPT_ID		INTEGER			NULL ,
  DISEASE_STATUS_CONCEPT_ID		INTEGER			NULL ,
  SPECIMEN_SOURCE_ID				  VARCHAR(50)	NULL ,
  SPECIMEN_SOURCE_VALUE				VARCHAR(50)	NULL ,
  UNIT_SOURCE_VALUE					  VARCHAR(50)	NULL ,
  ANATOMIC_SITE_SOURCE_VALUE	VARCHAR(50)	NULL ,
  DISEASE_STATUS_SOURCE_VALUE VARCHAR(50)	NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.DEATH
(
  PERSON_ID							  INTEGER			NOT NULL ,
  DEATH_DATE							DATE			  NOT NULL ,
  DEATH_DATETIME					TIMESTAMP		NULL ,
  DEATH_TYPE_CONCEPT_ID   INTEGER			NOT NULL ,
  CAUSE_CONCEPT_ID			  INTEGER			NULL ,
  CAUSE_SOURCE_VALUE			VARCHAR(50)	NULL,
  CAUSE_SOURCE_CONCEPT_ID INTEGER			NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.VISIT_OCCURRENCE
(
  VISIT_OCCURRENCE_ID			      INTEGER			NOT NULL ,
  PERSON_ID						          INTEGER			NOT NULL ,
  VISIT_CONCEPT_ID				      INTEGER			NOT NULL ,
  VISIT_START_DATE				      DATE			  NOT NULL ,
  VISIT_START_DATETIME				  TIMESTAMP		NULL ,
  VISIT_END_DATE					      DATE			  NOT NULL ,
  VISIT_END_DATETIME					  TIMESTAMP		NULL ,
  VISIT_TYPE_CONCEPT_ID			    INTEGER			NOT NULL ,
  PROVIDER_ID					          INTEGER			NULL,
  CARE_SITE_ID					        INTEGER			NULL,
  VISIT_SOURCE_VALUE				    VARCHAR(50)	NULL,
  VISIT_SOURCE_CONCEPT_ID		    INTEGER			NULL ,
  ADMITTING_SOURCE_CONCEPT_ID	  INTEGER			NULL ,
  ADMITTING_SOURCE_VALUE		    VARCHAR(50)	NULL ,
  DISCHARGE_TO_CONCEPT_ID		    INTEGER   	NULL ,
  DISCHARGE_TO_SOURCE_VALUE		  VARCHAR(50)	NULL ,
  PRECEDING_VISIT_OCCURRENCE_ID	INTEGER			NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.VISIT_DETAIL
(
  VISIT_DETAIL_ID                    INTEGER     NOT NULL ,
  PERSON_ID                          INTEGER     NOT NULL ,
  VISIT_DETAIL_CONCEPT_ID            INTEGER     NOT NULL ,
  VISIT_DETAIL_START_DATE            DATE        NOT NULL ,
  VISIT_DETAIL_START_DATETIME        TIMESTAMP    NULL ,
  VISIT_DETAIL_END_DATE              DATE        NOT NULL ,
  VISIT_DETAIL_END_DATETIME          TIMESTAMP    NULL ,
  VISIT_DETAIL_TYPE_CONCEPT_ID       INTEGER     NOT NULL ,
  PROVIDER_ID                        INTEGER     NULL ,
  CARE_SITE_ID                       INTEGER     NULL ,
  ADMITTING_SOURCE_CONCEPT_ID        INTEGER     NULL ,
  DISCHARGE_TO_CONCEPT_ID            INTEGER     NULL ,
  PRECEDING_VISIT_DETAIL_ID          INTEGER     NULL ,
  VISIT_DETAIL_SOURCE_VALUE          VARCHAR(50) NULL ,
  VISIT_DETAIL_SOURCE_CONCEPT_ID     INTEGER     NULL ,
  ADMITTING_SOURCE_VALUE             VARCHAR(50) NULL ,
  DISCHARGE_TO_SOURCE_VALUE          VARCHAR(50) NULL ,
  VISIT_DETAIL_PARENT_ID             INTEGER     NULL ,
  VISIT_OCCURRENCE_ID                INTEGER     NOT NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.PROCEDURE_OCCURRENCE
(
  PROCEDURE_OCCURRENCE_ID		  INTEGER			NOT NULL ,
  PERSON_ID						        INTEGER			NOT NULL ,
  PROCEDURE_CONCEPT_ID			  INTEGER			NOT NULL ,
  PROCEDURE_DATE				      DATE			  NOT NULL ,
  PROCEDURE_DATETIME			    TIMESTAMP		NULL ,
  PROCEDURE_TYPE_CONCEPT_ID		INTEGER			NOT NULL ,
  MODIFIER_CONCEPT_ID			    INTEGER			NULL ,
  QUANTITY						        INTEGER			NULL ,
  PROVIDER_ID					        INTEGER			NULL ,
  VISIT_OCCURRENCE_ID			    INTEGER			NULL ,
  VISIT_DETAIL_ID             INTEGER     NULL ,
  PROCEDURE_SOURCE_VALUE		  VARCHAR(50)	NULL ,
  PROCEDURE_SOURCE_CONCEPT_ID	INTEGER			NULL ,
  MODIFIER_SOURCE_VALUE		   VARCHAR(50)	NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.DRUG_EXPOSURE
(
  DRUG_EXPOSURE_ID				      INTEGER			  NOT NULL ,
  PERSON_ID						          INTEGER			  NOT NULL ,
  DRUG_CONCEPT_ID				        INTEGER			  NOT NULL ,
  DRUG_EXPOSURE_START_DATE		  DATE			    NOT NULL ,
  DRUG_EXPOSURE_START_DATETIME  TIMESTAMP		  NULL ,
  DRUG_EXPOSURE_END_DATE		    DATE			    NOT NULL ,
  DRUG_EXPOSURE_END_DATETIME	  TIMESTAMP		  NULL ,
  VERBATIM_END_DATE				      DATE			    NULL ,
  DRUG_TYPE_CONCEPT_ID			    INTEGER			  NOT NULL ,
  STOP_REASON					          VARCHAR(20)		NULL ,
  REFILLS						            INTEGER		  	NULL ,
  QUANTITY						          NUMERIC			    NULL ,
  DAYS_SUPPLY					          INTEGER		  	NULL ,
  SIG							              TEXT	NULL ,
  ROUTE_CONCEPT_ID				      INTEGER			  NULL ,
  LOT_NUMBER					          VARCHAR(50)	  NULL ,
  PROVIDER_ID					          INTEGER			  NULL ,
  VISIT_OCCURRENCE_ID			      INTEGER			  NULL ,
  VISIT_DETAIL_ID               INTEGER       NULL ,
  DRUG_SOURCE_VALUE				      VARCHAR(50)	  NULL ,
  DRUG_SOURCE_CONCEPT_ID		    INTEGER			  NULL ,
  ROUTE_SOURCE_VALUE			      VARCHAR(50)	  NULL ,
  DOSE_UNIT_SOURCE_VALUE		    VARCHAR(50)	  NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.DEVICE_EXPOSURE
(
  DEVICE_EXPOSURE_ID			        INTEGER		  	NOT NULL ,
  PERSON_ID						            INTEGER			  NOT NULL ,
  DEVICE_CONCEPT_ID			        	INTEGER			  NOT NULL ,
  DEVICE_EXPOSURE_START_DATE	    DATE			    NOT NULL ,
  DEVICE_EXPOSURE_START_DATETIME  TIMESTAMP		  NULL ,
  DEVICE_EXPOSURE_END_DATE		    DATE			    NULL ,
  DEVICE_EXPOSURE_END_DATETIME    TIMESTAMP		  NULL ,
  DEVICE_TYPE_CONCEPT_ID		      INTEGER			  NOT NULL ,
  UNIQUE_DEVICE_ID			        	VARCHAR(50)		NULL ,
  QUANTITY						            INTEGER			  NULL ,
  PROVIDER_ID					            INTEGER			  NULL ,
  VISIT_OCCURRENCE_ID			        INTEGER			  NULL ,
  VISIT_DETAIL_ID                 INTEGER       NULL ,
  DEVICE_SOURCE_VALUE			        VARCHAR(100)	NULL ,
  DEVICE_SOURCE_CONCEPT_ID		    INTEGER			  NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.CONDITION_OCCURRENCE
(
  CONDITION_OCCURRENCE_ID		    INTEGER			NOT NULL ,
  PERSON_ID						          INTEGER			NOT NULL ,
  CONDITION_CONCEPT_ID			    INTEGER			NOT NULL ,
  CONDITION_START_DATE			    DATE			  NOT NULL ,
  CONDITION_START_DATETIME		  TIMESTAMP		NULL ,
  CONDITION_END_DATE			      DATE			  NULL ,
  CONDITION_END_DATETIME		    TIMESTAMP		NULL ,
  CONDITION_TYPE_CONCEPT_ID		  INTEGER			NOT NULL ,
  STOP_REASON					          VARCHAR(20)	NULL ,
  PROVIDER_ID					          INTEGER			NULL ,
  VISIT_OCCURRENCE_ID			      INTEGER			NULL ,
  VISIT_DETAIL_ID               INTEGER     NULL ,
  CONDITION_SOURCE_VALUE		    VARCHAR(50)	NULL ,
  CONDITION_SOURCE_CONCEPT_ID	  INTEGER			NULL ,
  CONDITION_STATUS_SOURCE_VALUE	VARCHAR(50)	NULL ,
  CONDITION_STATUS_CONCEPT_ID	  INTEGER			NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.MEASUREMENT
(
  MEASUREMENT_ID				        INTEGER			NOT NULL ,
  PERSON_ID						          INTEGER			NOT NULL ,
  MEASUREMENT_CONCEPT_ID		    INTEGER			NOT NULL ,
  MEASUREMENT_DATE				      DATE			  NOT NULL ,
  MEASUREMENT_DATETIME			    TIMESTAMP		NULL ,
  MEASUREMENT_TIME              VARCHAR(10) NULL,
  MEASUREMENT_TYPE_CONCEPT_ID	  INTEGER			NOT NULL ,
  OPERATOR_CONCEPT_ID			      INTEGER			NULL ,
  VALUE_AS_NUMBER				        NUMERIC			  NULL ,
  VALUE_AS_CONCEPT_ID			      INTEGER			NULL ,
  UNIT_CONCEPT_ID				        INTEGER			NULL ,
  RANGE_LOW					          	NUMERIC			  NULL ,
  RANGE_HIGH					          NUMERIC			  NULL ,
  PROVIDER_ID					          INTEGER			NULL ,
  VISIT_OCCURRENCE_ID			      INTEGER			NULL ,
  VISIT_DETAIL_ID               INTEGER     NULL ,
  MEASUREMENT_SOURCE_VALUE		  VARCHAR(50)	NULL ,
  MEASUREMENT_SOURCE_CONCEPT_ID	INTEGER			NULL ,
  UNIT_SOURCE_VALUE				      VARCHAR(50)	NULL ,
  VALUE_SOURCE_VALUE			      VARCHAR(50)	NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.NOTE
(
  NOTE_ID						    INTEGER			  NOT NULL ,
  PERSON_ID						  INTEGER			  NOT NULL ,
  NOTE_DATE						  DATE			    NOT NULL ,
  NOTE_DATETIME					TIMESTAMP		  NULL ,
  NOTE_TYPE_CONCEPT_ID	INTEGER			  NOT NULL ,
  NOTE_CLASS_CONCEPT_ID INTEGER			  NOT NULL ,
  NOTE_TITLE					  VARCHAR(250)	NULL ,
  NOTE_TEXT						  TEXT  NULL ,
  ENCODING_CONCEPT_ID		INTEGER			  NOT NULL ,
  LANGUAGE_CONCEPT_ID		INTEGER			  NOT NULL ,
  PROVIDER_ID					  INTEGER			  NULL ,
  VISIT_OCCURRENCE_ID		INTEGER			  NULL ,
  VISIT_DETAIL_ID       INTEGER       NULL ,
  NOTE_SOURCE_VALUE			VARCHAR(50)		NULL
)
;



CREATE TABLE cdm.NOTE_NLP
(
  NOTE_NLP_ID					        INTEGER			  NOT NULL ,
  NOTE_ID						          INTEGER			  NOT NULL ,
  SECTION_CONCEPT_ID			    INTEGER			  NULL ,
  SNIPPET						          VARCHAR(250)	NULL ,
  "OFFSET"					          VARCHAR(250)	NULL ,
  LEXICAL_VARIANT				      VARCHAR(250)	NOT NULL ,
  NOTE_NLP_CONCEPT_ID			    INTEGER			  NULL ,
  NOTE_NLP_SOURCE_CONCEPT_ID  INTEGER			  NULL ,
  NLP_SYSTEM					        VARCHAR(250)	NULL ,
  NLP_DATE						        DATE			    NOT NULL ,
  NLP_DATETIME					      TIMESTAMP		  NULL ,
  TERM_EXISTS					        VARCHAR(1)		NULL ,
  TERM_TEMPORAL					      VARCHAR(50)		NULL ,
  TERM_MODIFIERS				      VARCHAR(2000)	NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.OBSERVATION
(
  OBSERVATION_ID					      INTEGER			NOT NULL ,
  PERSON_ID						          INTEGER			NOT NULL ,
  OBSERVATION_CONCEPT_ID			  INTEGER			NOT NULL ,
  OBSERVATION_DATE				      DATE			  NOT NULL ,
  OBSERVATION_DATETIME				  TIMESTAMP		NULL ,
  OBSERVATION_TYPE_CONCEPT_ID	  INTEGER			NOT NULL ,
  VALUE_AS_NUMBER				        NUMERIC			  NULL ,
  VALUE_AS_STRING				        VARCHAR(60)	NULL ,
  VALUE_AS_CONCEPT_ID			      INTEGER			NULL ,
  QUALIFIER_CONCEPT_ID			    INTEGER			NULL ,
  UNIT_CONCEPT_ID				        INTEGER			NULL ,
  PROVIDER_ID					          INTEGER			NULL ,
  VISIT_OCCURRENCE_ID			      INTEGER			NULL ,
  VISIT_DETAIL_ID               INTEGER     NULL ,
  OBSERVATION_SOURCE_VALUE		  VARCHAR(50)	NULL ,
  OBSERVATION_SOURCE_CONCEPT_ID	INTEGER			NULL ,
  UNIT_SOURCE_VALUE				      VARCHAR(50)	NULL ,
  QUALIFIER_SOURCE_VALUE			  VARCHAR(50)	NULL
)
;


CREATE TABLE cdm.FACT_RELATIONSHIP
(
  DOMAIN_CONCEPT_ID_1			INTEGER			NOT NULL ,
  FACT_ID_1						    INTEGER			NOT NULL ,
  DOMAIN_CONCEPT_ID_2			INTEGER			NOT NULL ,
  FACT_ID_2						    INTEGER			NOT NULL ,
  RELATIONSHIP_CONCEPT_ID	INTEGER			NOT NULL
)
;



/************************

STANDARDIZED HEALTH SYSTEM DATA

************************/


CREATE TABLE cdm.LOCATION
(
  LOCATION_ID					  INTEGER			  NOT NULL ,
  ADDRESS_1						  VARCHAR(50)		NULL ,
  ADDRESS_2						  VARCHAR(50)		NULL ,
  CITY							    VARCHAR(50)		NULL ,
  STATE							    VARCHAR(2)		NULL ,
  ZIP							      VARCHAR(9)		NULL ,
  COUNTY							  VARCHAR(20)		NULL ,
  LOCATION_SOURCE_VALUE VARCHAR(50)		NULL
)
;


CREATE TABLE cdm.CARE_SITE
(
  CARE_SITE_ID						      INTEGER			  NOT NULL ,
  CARE_SITE_NAME						    VARCHAR(255)  NULL ,
  PLACE_OF_SERVICE_CONCEPT_ID	  INTEGER			  NULL ,
  LOCATION_ID						        INTEGER			  NULL ,
  CARE_SITE_SOURCE_VALUE			  VARCHAR(50)		NULL ,
  PLACE_OF_SERVICE_SOURCE_VALUE VARCHAR(50)		NULL
)
;


CREATE TABLE cdm.PROVIDER
(
  PROVIDER_ID					        INTEGER			  NOT NULL ,
  PROVIDER_NAME					      VARCHAR(255)	NULL ,
  NPI							            VARCHAR(20)		NULL ,
  DEA							            VARCHAR(20)		NULL ,
  SPECIALTY_CONCEPT_ID			  INTEGER			  NULL ,
  CARE_SITE_ID					      INTEGER			  NULL ,
  YEAR_OF_BIRTH					      INTEGER			  NULL ,
  GENDER_CONCEPT_ID				    INTEGER			  NULL ,
  PROVIDER_SOURCE_VALUE			  VARCHAR(50)		NULL ,
  SPECIALTY_SOURCE_VALUE			VARCHAR(50)		NULL ,
  SPECIALTY_SOURCE_CONCEPT_ID	INTEGER			  NULL ,
  GENDER_SOURCE_VALUE			    VARCHAR(50)		NULL ,
  GENDER_SOURCE_CONCEPT_ID		INTEGER			  NULL
)
;


/************************

STANDARDIZED HEALTH ECONOMICS

************************/


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.PAYER_PLAN_PERIOD
(
  PAYER_PLAN_PERIOD_ID			    INTEGER			  NOT NULL ,
  PERSON_ID						          INTEGER			  NOT NULL ,
  PAYER_PLAN_PERIOD_START_DATE  DATE			    NOT NULL ,
  PAYER_PLAN_PERIOD_END_DATE		DATE			    NOT NULL ,
  PAYER_CONCEPT_ID              INTEGER       NULL ,
  PAYER_SOURCE_VALUE				    VARCHAR(50)	  NULL ,
  PAYER_SOURCE_CONCEPT_ID       INTEGER       NULL ,
  PLAN_CONCEPT_ID               INTEGER       NULL ,
  PLAN_SOURCE_VALUE				      VARCHAR(50)	  NULL ,
  PLAN_SOURCE_CONCEPT_ID        INTEGER       NULL ,
  SPONSOR_CONCEPT_ID            INTEGER       NULL ,
  SPONSOR_SOURCE_VALUE          VARCHAR(50)   NULL ,
  SPONSOR_SOURCE_CONCEPT_ID     INTEGER       NULL ,
  FAMILY_SOURCE_VALUE			      VARCHAR(50)	  NULL ,
  STOP_REASON_CONCEPT_ID        INTEGER       NULL ,
  STOP_REASON_SOURCE_VALUE      VARCHAR(50)      NULL ,
  STOP_REASON_SOURCE_CONCEPT_ID INTEGER       NULL
)
;


CREATE TABLE cdm.COST
(
  COST_ID					          INTEGER	    NOT NULL ,
  COST_EVENT_ID             INTEGER     NOT NULL ,
  COST_DOMAIN_ID            VARCHAR(20) NOT NULL ,
  COST_TYPE_CONCEPT_ID      INTEGER     NOT NULL ,
  CURRENCY_CONCEPT_ID			  INTEGER			NULL ,
  TOTAL_CHARGE						  NUMERIC			  NULL ,
  TOTAL_COST						    NUMERIC			  NULL ,
  TOTAL_PAID						    NUMERIC			  NULL ,
  PAID_BY_PAYER					    NUMERIC			  NULL ,
  PAID_BY_PATIENT						NUMERIC			  NULL ,
  PAID_PATIENT_COPAY				NUMERIC			  NULL ,
  PAID_PATIENT_COINSURANCE  NUMERIC			  NULL ,
  PAID_PATIENT_DEDUCTIBLE		NUMERIC			  NULL ,
  PAID_BY_PRIMARY						NUMERIC			  NULL ,
  PAID_INGREDIENT_COST			NUMERIC			  NULL ,
  PAID_DISPENSING_FEE				NUMERIC			  NULL ,
  PAYER_PLAN_PERIOD_ID			INTEGER			NULL ,
  AMOUNT_ALLOWED		        NUMERIC			  NULL ,
  REVENUE_CODE_CONCEPT_ID		INTEGER			NULL ,
  REVEUE_CODE_SOURCE_VALUE  VARCHAR(50) NULL,
  DRG_CONCEPT_ID			      INTEGER		  NULL,
  DRG_SOURCE_VALUE			    VARCHAR(3)	NULL
)
;


/************************

STANDARDIZED DERIVED ELEMENTS

************************/


--HINT DISTRIBUTE_ON_KEY(SUBJECT_ID)
CREATE TABLE cdm.COHORT
(
  COHORT_DEFINITION_ID	INTEGER		NOT NULL ,
  SUBJECT_ID						INTEGER		NOT NULL ,
  COHORT_START_DATE			DATE			NOT NULL ,
  COHORT_END_DATE				DATE			NOT NULL
)
;


--HINT DISTRIBUTE_ON_KEY(SUBJECT_ID)
CREATE TABLE cdm.COHORT_ATTRIBUTE
(
  COHORT_DEFINITION_ID		INTEGER		NOT NULL ,
  SUBJECT_ID						  INTEGER		NOT NULL ,
  COHORT_START_DATE				DATE			NOT NULL ,
  COHORT_END_DATE				  DATE			NOT NULL ,
  ATTRIBUTE_DEFINITION_ID INTEGER		NOT NULL ,
  VALUE_AS_NUMBER				  NUMERIC			NULL ,
  VALUE_AS_CONCEPT_ID			INTEGER		NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.DRUG_ERA
(
  DRUG_ERA_ID					INTEGER			NOT NULL ,
  PERSON_ID						INTEGER			NOT NULL ,
  DRUG_CONCEPT_ID			INTEGER			NOT NULL ,
  DRUG_ERA_START_DATE	DATE			  NOT NULL ,
  DRUG_ERA_END_DATE		DATE			  NOT NULL ,
  DRUG_EXPOSURE_COUNT	INTEGER			NULL ,
  GAP_DAYS						INTEGER			NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.DOSE_ERA
(
  DOSE_ERA_ID					  INTEGER			NOT NULL ,
  PERSON_ID						  INTEGER			NOT NULL ,
  DRUG_CONCEPT_ID				INTEGER			NOT NULL ,
  UNIT_CONCEPT_ID				INTEGER			NOT NULL ,
  DOSE_VALUE						NUMERIC			  NOT NULL ,
  DOSE_ERA_START_DATE		DATE			  NOT NULL ,
  DOSE_ERA_END_DATE	    DATE			  NOT NULL
)
;


--HINT DISTRIBUTE_ON_KEY(PERSON_ID)
CREATE TABLE cdm.CONDITION_ERA
(
  CONDITION_ERA_ID				    INTEGER			NOT NULL ,
  PERSON_ID						        INTEGER			NOT NULL ,
  CONDITION_CONCEPT_ID			  INTEGER			NOT NULL ,
  CONDITION_ERA_START_DATE		DATE			  NOT NULL ,
  CONDITION_ERA_END_DATE			DATE			  NOT NULL ,
  CONDITION_OCCURRENCE_COUNT	INTEGER			NULL
)
;
